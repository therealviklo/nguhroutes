<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>NguhRoutes</title>
		<script>
			let routes = null;

			function startup() {
				fetch('./gen/json/routes.json')
					.then(response => response.json())
					.then(data => {
						routes = data;
						const loading = document.getElementById("loading");
						const searcher = document.getElementById("searcher");
						loading.hidden = true;
						searcher.hidden = false;
					})
					.catch(error => {
						console.error('Error loading routes.json:', error);
						document.getElementById("loading-text").innerText = "An error occured while loading.";
					});
			}

			function findRoute() {
				if (!routes) {
					console.error("Cannot find route because routes have not been loaded yet");
					return;
				}
				const output = document.getElementById("route");
				const startStation = document.getElementById("start-station").value?.trim().toUpperCase();
				if (!startStation) {
					output.innerText = "Please enter a start station";
					return;
				}
				const endStation = document.getElementById("end-station").value?.trim().toUpperCase();
				if (!endStation) {
					output.innerText = "Please enter an end station";
					return;
				}
				const route = routes["routes"][`${startStation}\`${endStation}`];
				if (!route) {
					output.innerText = `Could not find a route between "${startStation}" and "${endStation}"`;
					return;
				}
				let routeStr = "";
				let line = "Unknown line";
				for (const stop of route) {
					let code;
					if (Array.isArray(stop)) {
						code = stop[0];
						line = stop[1];
					} else {
						code = stop;
					}
					if (routeStr.length > 0)
						routeStr += "<br>";
					routeStr += `${code} (${line})`;
				}
				output.innerHTML = routeStr;
			}
		</script>
	</head>
	<body onload="startup()">
		<h1>NguhRoutes</h1>
		<p>
			Rail line route planner for Nguhcraft (very WIP). Currently only supports some of Cenrail.
			The network data is taken from a file posted by Total Pleb, and is incomplete
			and probably a bit outdated. See the <a href="https://github.com/therealviklo/nguhroutes">Github page</a>
			for more information.
		</p>
		<div id="loading"><p id="loading-text">Loading...</p></div>
		<div id="searcher" hidden>
			<label for="start-station">Start Station:</label>
			<input type="text" id="start-station" name="start-station" placeholder="MZS">
			<br>
			<label for="end-station">End Station:</label>
			<input type="text" id="end-station" name="end-station" placeholder="SXG">
			<br>
			<button onclick="findRoute()">Find route</button>
			<br>
			<span id="route"></span>
		</div>
	</body>
</html>